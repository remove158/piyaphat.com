---
import BlogPost from "@/layouts/BlogPost.astro";
import { ArrowUpRightFromSquare } from "lucide-react"
import { getCollection, type CollectionEntry, getEntries, getEntry } from "astro:content";
import dayjs from 'dayjs';
import "dayjs/locale/th";
import LocalizedFormat from 'dayjs/plugin/localizedFormat'

export async function getStaticPaths() {
	const posts = await getCollection("blog");
	return posts.map((post) => ({
		params: { slug: post.slug },
		props: post,
	}));
}
type Props = CollectionEntry<"blog">;
dayjs.extend(LocalizedFormat)
dayjs.locale('th')
const post = Astro.props;
const categories = await getEntries(post.data.categories);
const author = await getEntry(post.data.author)
const { Content } = await post.render();
---

<BlogPost {...post.data}>
	<div class="mb-4">
		<div class=" flex h-full items-center space-x-1 text-sm text-muted-foreground">
			<a href="/blog">
				<div class="overflow-hidden text-ellipsis whitespace-nowrap">Blog</div>
			</a>
			<svg
			width="15"
			height="15"
			viewBox="0 0 15 15"
			fill="none"
			xmlns="http://www.w3.org/2000/svg"
			class="h-4 w-4"
			><path
			d="M6.1584 3.13508C6.35985 2.94621 6.67627 2.95642 6.86514 3.15788L10.6151 7.15788C10.7954 7.3502 10.7954 7.64949 10.6151 7.84182L6.86514 11.8418C6.67627 12.0433 6.35985 12.0535 6.1584 11.8646C5.95694 11.6757 5.94673 11.3593 6.1356 11.1579L9.565 7.49985L6.1356 3.84182C5.94673 3.64036 5.95694 3.32394 6.1584 3.13508Z"
			fill="currentColor"
			fill-rule="evenodd"
			clip-rule="evenodd"></path></svg
			><a href={`/blog/${post.slug}`}>
				<div class="font-medium text-foreground">{post.data.title}</div>
			</a>
		</div>
		<span class="ml-auto text-balance text-sm leading-loose text-muted-foreground ">
					โดย <a class="underline" href={author.data.link}>ปิยะพัทธ์ ภิญโญ</a> เมื่อ {dayjs(post.data.pubDate).format("LL")}
		</span>
	</div>
	</div>
	<div class="flex flex-col ">
		<div class="space-y-1">
			<h1 class="text-3xl font-bold tracking-tight">
				{post.data.title}
			</h1>
			<p class="text-lg text-muted-foreground">
				{post.data.description} 		
			</p>
			
			<div>
				{
					categories.map((cate) => (
						<a
							target="_blank"
							rel="noreferrer"
							class="inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80 gap-1 hover:text-secondary-foreground/80"
							href={`/categories/${cate.id}`}
						>
						{cate.data.title}
						<ArrowUpRightFromSquare size="12"/>
						</a>
					))
				}
			</div>

		</div>

	</div>
	<div
		class="prose py-8 prose-img:rounded-xl prose-h1:border-b prose-h2:border-b dark:prose-invert lg:prose-xl"
	>
		<Content />
	</div>
</BlogPost>
